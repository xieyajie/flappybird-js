{"version":3,"sources":["resources/app.asar/node_modules/browser-pack/_prelude.js","Script/BirdCollision.js","project.js","Script/PillarGenerator.js"],"names":["require","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length","BirdCollision","module","cc","_RFpush","Class","extends","Component","properties","onLoad","manager","director","getCollisionManager","enabled","onCollisionEnter","other","self","node","group","this","dispatchEvent","Event","EventCustom","onCollisionExit","_RFpop","PillarGenerator","pillarPrefab","default","type","Prefab","tooltip","scroreSpacePrefab","scoreLabel","Label","score","visible","pillarSapce","pillarMinHeight","pillarMoveSpeed","pillarGenerateMargin","pillars","lastPillarGenerateMargin","birdPrefab","bird","birdUpSpeed","birdSpeed","birdGravitationalAcceleration","isCollided","startLayer","Node","setupEventListener","setupCollisionListener","setupStartLayer","setupBird","setupPillars","showStartLayer","update","dt","dtSpace","pillarArr","upPillar","downPillar","scoreSpace","x","width","generateTwoPillar","minX","shift","removeFromParent","currentBirdSpeed","birdUpHeight","rotation","birdY","getPositionY","setPositionY","root","parent","addChild","height","setPositionX","tmpPillar","instantiate","maxX","restartGame","string","toString","effectHeight","spaceCenterY","Math","random","upPillarDownY","upPillarHeight","upY","generateAPillar","downPillarUpY","downPillarHeight","downY","scoreSpaceCollider","getComponent","BoxCollider","size","offset","y","push","pillar","collider","on","EventType","TOUCH_START","event","script"],"mappings":"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","file":"project.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\"use strict\";\ncc._RFpush(module, '480d61GWTdMMaFhZexSRiJO', 'BirdCollision');\n// Script\\BirdCollision.js\n\ncc.Class({\n    \"extends\": cc.Component,\n\n    properties: {},\n\n    // use this for initialization\n    onLoad: function onLoad() {\n        var manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n\n    /**\r\n     * 当碰撞产生的时候调用\r\n     * @param  {Collider} other 产生碰撞的另一个碰撞组件\r\n     * @param  {Collider} self  产生碰撞的自身的碰撞组件\r\n     */\n    onCollisionEnter: function onCollisionEnter(other, self) {\n        if (other.node.group == \"Pillar\") {\n            this.node.dispatchEvent(new cc.Event.EventCustom('collided', true));\n        }\n    },\n\n    onCollisionExit: function onCollisionExit(other, self) {\n        if (other.node.group == \"ScoreSpace\") {\n            this.node.dispatchEvent(new cc.Event.EventCustom('score', true));\n        }\n    }\n});\n\ncc._RFpop();","require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({\"BirdCollision\":[function(require,module,exports){\n\"use strict\";\ncc._RFpush(module, '480d61GWTdMMaFhZexSRiJO', 'BirdCollision');\n// Script\\BirdCollision.js\n\ncc.Class({\n    \"extends\": cc.Component,\n\n    properties: {},\n\n    // use this for initialization\n    onLoad: function onLoad() {\n        var manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n\n    /**\r\n     * 当碰撞产生的时候调用\r\n     * @param  {Collider} other 产生碰撞的另一个碰撞组件\r\n     * @param  {Collider} self  产生碰撞的自身的碰撞组件\r\n     */\n    onCollisionEnter: function onCollisionEnter(other, self) {\n        if (other.node.group == \"Pillar\") {\n            this.node.dispatchEvent(new cc.Event.EventCustom('collided', true));\n        }\n    },\n\n    onCollisionExit: function onCollisionExit(other, self) {\n        if (other.node.group == \"ScoreSpace\") {\n            this.node.dispatchEvent(new cc.Event.EventCustom('score', true));\n        }\n    }\n});\n\ncc._RFpop();\n},{}],\"PillarGenerator\":[function(require,module,exports){\n\"use strict\";\ncc._RFpush(module, 'fec57h7ZKBEWbtIDVOxFXA9', 'PillarGenerator');\n// Script\\PillarGenerator.js\n\ncc.Class({\n    \"extends\": cc.Component,\n\n    properties: {\n        pillarPrefab: {\n            \"default\": null,\n            type: cc.Prefab,\n            tooltip: \"柱子障碍物的 Prefab\"\n        },\n\n        scroreSpacePrefab: {\n            \"default\": null,\n            type: cc.Prefab,\n            tooltip: \"柱子障碍物中间的空隙 prefab\"\n        },\n\n        scoreLabel: {\n            \"default\": null,\n            type: cc.Label,\n            tooltip: \"显示分数的 label 组件\"\n        },\n\n        score: {\n            \"default\": 0,\n            visible: false,\n            tooltip: \"玩家分数\"\n        },\n\n        pillarSapce: {\n            \"default\": 0,\n            tooltip: \"上下障碍物的中间空隙间距\"\n        },\n\n        pillarMinHeight: {\n            \"default\": 0,\n            tooltip: \"上下预留给障碍物的最小高度\"\n        },\n\n        pillarMoveSpeed: {\n            \"default\": 0,\n            tooltip: \"障碍物的移动速度\"\n        },\n\n        pillarGenerateMargin: {\n            \"default\": 0,\n            tooltip: \"间隔多远生成一次障碍物\"\n        },\n\n        pillars: {\n            \"default\": [],\n            visible: false,\n            tooltip: \"记录所有障碍物的数组\"\n        },\n\n        lastPillarGenerateMargin: {\n            \"default\": 0,\n            visible: false,\n            tooltip: \"距离上一次生成障碍物间隔了多远了\"\n        },\n\n        birdPrefab: {\n            \"default\": null,\n            type: cc.Prefab,\n            tooltip: \"小鸟的 Prefab\"\n        },\n\n        bird: {\n            \"default\": null,\n            visible: false,\n            tooltip: \"运行时生成的，当前在画面中的鸟\"\n        },\n\n        birdUpSpeed: {\n            \"default\": 0.0,\n            tooltip: \"点击屏幕时，鸟获得的上升速度\"\n        },\n\n        birdSpeed: {\n            \"default\": 0.0,\n            visible: false,\n            tooltip: \"鸟当前在 y 方向上的速度\"\n        },\n\n        birdGravitationalAcceleration: {\n            \"default\": 0.0,\n            tooltip: \"鸟下降的重力加速度\"\n        },\n\n        isCollided: {\n            \"default\": false,\n            visible: false,\n            tooltip: \"是否发生了碰撞\"\n        },\n\n        startLayer: {\n            \"default\": null,\n            type: cc.Node,\n            tooltip: \"开始游戏视图\"\n        }\n    },\n\n    // use this for initialization\n    onLoad: function onLoad() {\n        this.setupEventListener();\n        this.setupCollisionListener();\n        this.setupStartLayer();\n        this.setupBird();\n        this.setupPillars();\n\n        this.showStartLayer();\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function update(dt) {\n        if (this.isCollided) {\n            return;\n        }\n\n        // 本次更新移动的距离\n        var dtSpace = dt * this.pillarMoveSpeed;\n\n        // 移动各个障碍物\n        for (var i = 0; i < this.pillars.length; i++) {\n            var pillarArr = this.pillars[i];\n            var upPillar = pillarArr[0];\n            var downPillar = pillarArr[1];\n            var scoreSpace = pillarArr[2];\n\n            upPillar.x -= dtSpace;\n            downPillar.x -= dtSpace;\n            scoreSpace.x -= dtSpace;\n        }\n\n        // 记录距离上一次生成障碍物间隔了多远了\n        this.lastPillarGenerateMargin += dtSpace;\n\n        // 检查是否需要生成新的障碍物\n        if (this.lastPillarGenerateMargin >= this.pillarGenerateMargin) {\n            // TODO：这里会有误差的应该\n            var x = this.node.width / 2 + this.pillars[0][0].width / 2;\n            this.generateTwoPillar(x);\n            this.lastPillarGenerateMargin = 0;\n        }\n\n        // 离开屏幕的障碍物的清理\n        for (var i = 0; i < this.pillars.length; i++) {\n            var pillarArr = this.pillars[i];\n            var upPillar = pillarArr[0];\n            var downPillar = pillarArr[1];\n            var scoreSpace = pillarArr[2];\n\n            var minX = -this.node.width / 2 - upPillar.width / 2;\n            if (upPillar.x < minX) {\n                this.pillars.shift();\n                upPillar.removeFromParent();\n                downPillar.removeFromParent();\n                scoreSpace.removeFromParent();\n            }\n        }\n\n        //鸟的当前速度\n        var currentBirdSpeed = this.birdSpeed - this.birdGravitationalAcceleration * dt;\n        this.birdSpeed = currentBirdSpeed;\n        var birdUpHeight = dt * this.birdSpeed;\n        this.bird.rotation = -20.0 * (currentBirdSpeed / this.birdUpSpeed);\n        var birdY = this.bird.getPositionY() + birdUpHeight;\n        this.bird.setPositionY(birdY);\n    },\n\n    /**\r\n     * 创建开始游戏视图\r\n     */\n    setupStartLayer: function setupStartLayer() {\n        this.startLayer.removeFromParent();\n    },\n\n    /**\r\n     * 切换显示开始游戏视图\r\n     */\n    showStartLayer: function showStartLayer() {\n        this.isCollided = true;\n\n        this.startLayer.removeFromParent();\n        var root = this.node.parent;\n        root.addChild(this.startLayer);\n        this.startLayer.width = root.width;\n        this.startLayer.height = root.height;\n        this.startLayer.setPositionX(0);\n        this.startLayer.setPositionY(0);\n    },\n\n    /**\r\n     * 生成初始的障碍物\r\n     */\n    setupPillars: function setupPillars() {\n        var tmpPillar = cc.instantiate(this.pillarPrefab);\n        // 最大可生成的位置\n        var maxX = this.node.width / 2 + tmpPillar.width / 2;\n        // 记录下最后一次生成位置的下一个位置\n        this.generateTwoPillar(maxX);\n        // 距离上一个生成位置已经间隔了多远\n        this.lastPillarGenerateMargin = 0;\n    },\n\n    /**\r\n     * 重新开始一局新游戏\r\n     */\n    restartGame: function restartGame() {\n        // 移除各个障碍物\n        for (var i = 0; i < this.pillars.length; i++) {\n            var pillarArr = this.pillars[i];\n            var upPillar = pillarArr[0];\n            var downPillar = pillarArr[1];\n            var scoreSpace = pillarArr[2];\n\n            upPillar.removeFromParent();\n            downPillar.removeFromParent();\n            scoreSpace.removeFromParent();\n        }\n        this.pillars = [];\n\n        // 移除鸟\n        this.bird.removeFromParent();\n\n        // 分数\n        this.score = 0;\n        this.scoreLabel.string = this.score.toString();\n\n        // 重新初始化设置\n        this.setupPillars();\n        this.setupBird();\n\n        this.startLayer.removeFromParent();\n\n        // 重新开始游戏\n        this.isCollided = false;\n    },\n\n    /**\r\n     * 生成一对新的障碍物并自动加入到场景中\r\n     * @param x 障碍物生成的水平位置\r\n     */\n    generateTwoPillar: function generateTwoPillar(x) {\n        // 障碍物的宽度\n        var width = cc.instantiate(this.pillarPrefab).width;\n\n        // 障碍物间隙中心位置上下\n        // 这里已经照顾到了上下障碍物都有个最小高度\n        var effectHeight = this.node.height - this.pillarMinHeight * 2 - this.pillarSapce;\n        var spaceCenterY = Math.random() * effectHeight - effectHeight / 2;\n\n        // 上边障碍物的下边缘位置\n        var upPillarDownY = spaceCenterY + this.pillarSapce / 2;\n        // 上边障碍物的高度\n        var upPillarHeight = this.node.height / 2 - upPillarDownY;\n        // 上边障碍物的 Y\n        var upY = upPillarDownY + upPillarHeight / 2;\n        // 生成上边的障碍物\n        var upPillar = this.generateAPillar(x, upY, width, upPillarHeight, 0);\n\n        // 下边障碍物的上边缘位置\n        var downPillarUpY = spaceCenterY - this.pillarSapce / 2;\n        // 下边障碍物的高度\n        var downPillarHeight = this.node.height / 2 + upPillarDownY;\n        // 下边障碍物的 Y\n        var downY = downPillarUpY - downPillarHeight / 2;\n        // 设置下边障碍物的位置大小\n        var downPillar = this.generateAPillar(x, downY, width, downPillarHeight, 180);\n\n        // 中间空隙中添加一个 scoreSpace 用于计分\n        var scoreSpace = cc.instantiate(this.scroreSpacePrefab);\n        this.node.addChild(scoreSpace);\n        scoreSpace.width = width;\n        scoreSpace.height = upPillarDownY - downPillarUpY;\n        scoreSpace.setPositionX(x);\n        scoreSpace.setPositionY(downPillarUpY + scoreSpace.height / 2);\n        var scoreSpaceCollider = scoreSpace.getComponent(cc.BoxCollider);\n        scoreSpaceCollider.size.width = scoreSpace.width;\n        scoreSpaceCollider.size.height = scoreSpace.height;\n        scoreSpaceCollider.offset.x = 0;\n        scoreSpaceCollider.offset.y = 0;\n\n        // 放到障碍物数组中\n        this.pillars.push([upPillar, downPillar, scoreSpace]);\n    },\n\n    /**\r\n     * 生成一个新的障碍物并自动加入到场景中\r\n     */\n    generateAPillar: function generateAPillar(x, y, width, height, rotation) {\n        // 生成障碍物实例\n        var pillar = cc.instantiate(this.pillarPrefab);\n        this.node.addChild(pillar);\n\n        // 设置障碍物的旋转\n        pillar.rotation = rotation;\n        // 设置障碍物的位置大小\n        pillar.width = width;\n        pillar.height = height;\n        pillar.setPositionX(x);\n        pillar.setPositionY(y);\n        // 设置碰撞体的位置大小\n        var collider = pillar.getComponent(cc.BoxCollider);\n        collider.size.width = pillar.width;\n        collider.size.height = pillar.height;\n        collider.offset.x = 0;\n        collider.offset.y = 0;\n\n        return pillar;\n    },\n\n    /**\r\n     * 生成初始的小鸟\r\n     */\n    setupBird: function setupBird() {\n        this.bird = cc.instantiate(this.birdPrefab);\n        // 初始化位置(x始终不变)\n        //x不变\n        var x = -200;\n        var y = 0;\n        this.bird.setPositionX(x);\n        this.bird.setPositionY(y);\n        this.node.addChild(this.bird);\n\n        this.birdSpeed = this.birdUpSpeed;\n    },\n\n    /**\r\n     * 初始化系统事件监听\r\n     */\n    setupEventListener: function setupEventListener() {\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event) {\n            if (this.startLayer.parent) {\n                this.restartGame();\n\n                return;\n            }\n\n            this.birdSpeed = this.birdUpSpeed;\n            this.bird.rotation = -20;\n        }, this);\n    },\n\n    /**\r\n     * 初始化碰撞检测\r\n     */\n    setupCollisionListener: function setupCollisionListener() {\n        this.node.on('collided', function (event) {\n            var script = this.getComponent('PillarGenerator');\n            script.isCollided = true;\n            script.showStartLayer();\n        });\n\n        this.node.on('score', function (event) {\n            var script = this.getComponent('PillarGenerator');\n            script.score++;\n            script.scoreLabel.string = script.score.toString();\n        });\n    }\n\n});\n\ncc._RFpop();\n},{}]},{},[\"BirdCollision\",\"PillarGenerator\"])\n\n","\"use strict\";\ncc._RFpush(module, 'fec57h7ZKBEWbtIDVOxFXA9', 'PillarGenerator');\n// Script\\PillarGenerator.js\n\ncc.Class({\n    \"extends\": cc.Component,\n\n    properties: {\n        pillarPrefab: {\n            \"default\": null,\n            type: cc.Prefab,\n            tooltip: \"柱子障碍物的 Prefab\"\n        },\n\n        scroreSpacePrefab: {\n            \"default\": null,\n            type: cc.Prefab,\n            tooltip: \"柱子障碍物中间的空隙 prefab\"\n        },\n\n        scoreLabel: {\n            \"default\": null,\n            type: cc.Label,\n            tooltip: \"显示分数的 label 组件\"\n        },\n\n        score: {\n            \"default\": 0,\n            visible: false,\n            tooltip: \"玩家分数\"\n        },\n\n        pillarSapce: {\n            \"default\": 0,\n            tooltip: \"上下障碍物的中间空隙间距\"\n        },\n\n        pillarMinHeight: {\n            \"default\": 0,\n            tooltip: \"上下预留给障碍物的最小高度\"\n        },\n\n        pillarMoveSpeed: {\n            \"default\": 0,\n            tooltip: \"障碍物的移动速度\"\n        },\n\n        pillarGenerateMargin: {\n            \"default\": 0,\n            tooltip: \"间隔多远生成一次障碍物\"\n        },\n\n        pillars: {\n            \"default\": [],\n            visible: false,\n            tooltip: \"记录所有障碍物的数组\"\n        },\n\n        lastPillarGenerateMargin: {\n            \"default\": 0,\n            visible: false,\n            tooltip: \"距离上一次生成障碍物间隔了多远了\"\n        },\n\n        birdPrefab: {\n            \"default\": null,\n            type: cc.Prefab,\n            tooltip: \"小鸟的 Prefab\"\n        },\n\n        bird: {\n            \"default\": null,\n            visible: false,\n            tooltip: \"运行时生成的，当前在画面中的鸟\"\n        },\n\n        birdUpSpeed: {\n            \"default\": 0.0,\n            tooltip: \"点击屏幕时，鸟获得的上升速度\"\n        },\n\n        birdSpeed: {\n            \"default\": 0.0,\n            visible: false,\n            tooltip: \"鸟当前在 y 方向上的速度\"\n        },\n\n        birdGravitationalAcceleration: {\n            \"default\": 0.0,\n            tooltip: \"鸟下降的重力加速度\"\n        },\n\n        isCollided: {\n            \"default\": false,\n            visible: false,\n            tooltip: \"是否发生了碰撞\"\n        },\n\n        startLayer: {\n            \"default\": null,\n            type: cc.Node,\n            tooltip: \"开始游戏视图\"\n        }\n    },\n\n    // use this for initialization\n    onLoad: function onLoad() {\n        this.setupEventListener();\n        this.setupCollisionListener();\n        this.setupStartLayer();\n        this.setupBird();\n        this.setupPillars();\n\n        this.showStartLayer();\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function update(dt) {\n        if (this.isCollided) {\n            return;\n        }\n\n        // 本次更新移动的距离\n        var dtSpace = dt * this.pillarMoveSpeed;\n\n        // 移动各个障碍物\n        for (var i = 0; i < this.pillars.length; i++) {\n            var pillarArr = this.pillars[i];\n            var upPillar = pillarArr[0];\n            var downPillar = pillarArr[1];\n            var scoreSpace = pillarArr[2];\n\n            upPillar.x -= dtSpace;\n            downPillar.x -= dtSpace;\n            scoreSpace.x -= dtSpace;\n        }\n\n        // 记录距离上一次生成障碍物间隔了多远了\n        this.lastPillarGenerateMargin += dtSpace;\n\n        // 检查是否需要生成新的障碍物\n        if (this.lastPillarGenerateMargin >= this.pillarGenerateMargin) {\n            // TODO：这里会有误差的应该\n            var x = this.node.width / 2 + this.pillars[0][0].width / 2;\n            this.generateTwoPillar(x);\n            this.lastPillarGenerateMargin = 0;\n        }\n\n        // 离开屏幕的障碍物的清理\n        for (var i = 0; i < this.pillars.length; i++) {\n            var pillarArr = this.pillars[i];\n            var upPillar = pillarArr[0];\n            var downPillar = pillarArr[1];\n            var scoreSpace = pillarArr[2];\n\n            var minX = -this.node.width / 2 - upPillar.width / 2;\n            if (upPillar.x < minX) {\n                this.pillars.shift();\n                upPillar.removeFromParent();\n                downPillar.removeFromParent();\n                scoreSpace.removeFromParent();\n            }\n        }\n\n        //鸟的当前速度\n        var currentBirdSpeed = this.birdSpeed - this.birdGravitationalAcceleration * dt;\n        this.birdSpeed = currentBirdSpeed;\n        var birdUpHeight = dt * this.birdSpeed;\n        this.bird.rotation = -20.0 * (currentBirdSpeed / this.birdUpSpeed);\n        var birdY = this.bird.getPositionY() + birdUpHeight;\n        this.bird.setPositionY(birdY);\n    },\n\n    /**\r\n     * 创建开始游戏视图\r\n     */\n    setupStartLayer: function setupStartLayer() {\n        this.startLayer.removeFromParent();\n    },\n\n    /**\r\n     * 切换显示开始游戏视图\r\n     */\n    showStartLayer: function showStartLayer() {\n        this.isCollided = true;\n\n        this.startLayer.removeFromParent();\n        var root = this.node.parent;\n        root.addChild(this.startLayer);\n        this.startLayer.width = root.width;\n        this.startLayer.height = root.height;\n        this.startLayer.setPositionX(0);\n        this.startLayer.setPositionY(0);\n    },\n\n    /**\r\n     * 生成初始的障碍物\r\n     */\n    setupPillars: function setupPillars() {\n        var tmpPillar = cc.instantiate(this.pillarPrefab);\n        // 最大可生成的位置\n        var maxX = this.node.width / 2 + tmpPillar.width / 2;\n        // 记录下最后一次生成位置的下一个位置\n        this.generateTwoPillar(maxX);\n        // 距离上一个生成位置已经间隔了多远\n        this.lastPillarGenerateMargin = 0;\n    },\n\n    /**\r\n     * 重新开始一局新游戏\r\n     */\n    restartGame: function restartGame() {\n        // 移除各个障碍物\n        for (var i = 0; i < this.pillars.length; i++) {\n            var pillarArr = this.pillars[i];\n            var upPillar = pillarArr[0];\n            var downPillar = pillarArr[1];\n            var scoreSpace = pillarArr[2];\n\n            upPillar.removeFromParent();\n            downPillar.removeFromParent();\n            scoreSpace.removeFromParent();\n        }\n        this.pillars = [];\n\n        // 移除鸟\n        this.bird.removeFromParent();\n\n        // 分数\n        this.score = 0;\n        this.scoreLabel.string = this.score.toString();\n\n        // 重新初始化设置\n        this.setupPillars();\n        this.setupBird();\n\n        this.startLayer.removeFromParent();\n\n        // 重新开始游戏\n        this.isCollided = false;\n    },\n\n    /**\r\n     * 生成一对新的障碍物并自动加入到场景中\r\n     * @param x 障碍物生成的水平位置\r\n     */\n    generateTwoPillar: function generateTwoPillar(x) {\n        // 障碍物的宽度\n        var width = cc.instantiate(this.pillarPrefab).width;\n\n        // 障碍物间隙中心位置上下\n        // 这里已经照顾到了上下障碍物都有个最小高度\n        var effectHeight = this.node.height - this.pillarMinHeight * 2 - this.pillarSapce;\n        var spaceCenterY = Math.random() * effectHeight - effectHeight / 2;\n\n        // 上边障碍物的下边缘位置\n        var upPillarDownY = spaceCenterY + this.pillarSapce / 2;\n        // 上边障碍物的高度\n        var upPillarHeight = this.node.height / 2 - upPillarDownY;\n        // 上边障碍物的 Y\n        var upY = upPillarDownY + upPillarHeight / 2;\n        // 生成上边的障碍物\n        var upPillar = this.generateAPillar(x, upY, width, upPillarHeight, 0);\n\n        // 下边障碍物的上边缘位置\n        var downPillarUpY = spaceCenterY - this.pillarSapce / 2;\n        // 下边障碍物的高度\n        var downPillarHeight = this.node.height / 2 + upPillarDownY;\n        // 下边障碍物的 Y\n        var downY = downPillarUpY - downPillarHeight / 2;\n        // 设置下边障碍物的位置大小\n        var downPillar = this.generateAPillar(x, downY, width, downPillarHeight, 180);\n\n        // 中间空隙中添加一个 scoreSpace 用于计分\n        var scoreSpace = cc.instantiate(this.scroreSpacePrefab);\n        this.node.addChild(scoreSpace);\n        scoreSpace.width = width;\n        scoreSpace.height = upPillarDownY - downPillarUpY;\n        scoreSpace.setPositionX(x);\n        scoreSpace.setPositionY(downPillarUpY + scoreSpace.height / 2);\n        var scoreSpaceCollider = scoreSpace.getComponent(cc.BoxCollider);\n        scoreSpaceCollider.size.width = scoreSpace.width;\n        scoreSpaceCollider.size.height = scoreSpace.height;\n        scoreSpaceCollider.offset.x = 0;\n        scoreSpaceCollider.offset.y = 0;\n\n        // 放到障碍物数组中\n        this.pillars.push([upPillar, downPillar, scoreSpace]);\n    },\n\n    /**\r\n     * 生成一个新的障碍物并自动加入到场景中\r\n     */\n    generateAPillar: function generateAPillar(x, y, width, height, rotation) {\n        // 生成障碍物实例\n        var pillar = cc.instantiate(this.pillarPrefab);\n        this.node.addChild(pillar);\n\n        // 设置障碍物的旋转\n        pillar.rotation = rotation;\n        // 设置障碍物的位置大小\n        pillar.width = width;\n        pillar.height = height;\n        pillar.setPositionX(x);\n        pillar.setPositionY(y);\n        // 设置碰撞体的位置大小\n        var collider = pillar.getComponent(cc.BoxCollider);\n        collider.size.width = pillar.width;\n        collider.size.height = pillar.height;\n        collider.offset.x = 0;\n        collider.offset.y = 0;\n\n        return pillar;\n    },\n\n    /**\r\n     * 生成初始的小鸟\r\n     */\n    setupBird: function setupBird() {\n        this.bird = cc.instantiate(this.birdPrefab);\n        // 初始化位置(x始终不变)\n        //x不变\n        var x = -200;\n        var y = 0;\n        this.bird.setPositionX(x);\n        this.bird.setPositionY(y);\n        this.node.addChild(this.bird);\n\n        this.birdSpeed = this.birdUpSpeed;\n    },\n\n    /**\r\n     * 初始化系统事件监听\r\n     */\n    setupEventListener: function setupEventListener() {\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event) {\n            if (this.startLayer.parent) {\n                this.restartGame();\n\n                return;\n            }\n\n            this.birdSpeed = this.birdUpSpeed;\n            this.bird.rotation = -20;\n        }, this);\n    },\n\n    /**\r\n     * 初始化碰撞检测\r\n     */\n    setupCollisionListener: function setupCollisionListener() {\n        this.node.on('collided', function (event) {\n            var script = this.getComponent('PillarGenerator');\n            script.isCollided = true;\n            script.showStartLayer();\n        });\n\n        this.node.on('score', function (event) {\n            var script = this.getComponent('PillarGenerator');\n            script.score++;\n            script.scoreLabel.string = script.score.toString();\n        });\n    }\n\n});\n\ncc._RFpop();"],"sourceRoot":"/source/"}